---
title: "Paquete de funciones para Rstudio"
author: "Ricardo Morales"
date: "2023-03-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
######## En las primeras funciones se utiliza una librería proveniente del mismo Rstudio, esto para facilitar la creación de las funciones, además cada librería usada se encontrara en la parte superior de cada función.

## Codigo de la 1era función 

############ Librerías usadas.
```{r message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(testthat)
```

############ Cargamos la base de datos "mtcars" de R
```{r message=FALSE, warning=FALSE}
data(mtcars)
```
############ Definimos la función de regresión lineal simple
```{r message=FALSE, warning=FALSE}
  reg_lineal <- function(x, y) {
  
  # Verificamos que los datos sean del mismo tamaño
  if(length(x) != length(y)) {
    stop("Los vectores deben tener el mismo tamaño.")
  }
  
  # Creamos el modelo de regresión lineal
  modelo <- lm(y ~ x)
  
  # Graficamos los datos y la recta de regresión
  plot(x, y, main = "Regresión lineal", xlab = "x", ylab = "y")
  abline(modelo, col = "red")
  
  # Retornamos el modelo de regresión lineal
  return(modelo)
}
```
############ Ejemplo de uso de la función
```{r message=FALSE, warning=FALSE}
reg_lineal(mtcars$wt, mtcars$mpg)
```
############ Esperamos que la función falle si los vectores tienen diferente tamaño
```{r message=FALSE, warning=FALSE}
expect_error(reg_lineal(c(1, 2, 3), c(4, 5)))
```

## Codigo de la 2da función 

############ Librerías usadas.
```{r message=FALSE, warning=FALSE}
library("tidyverse")
library("broom")
```
############ Cargamos la base de datos "mtcars" de R
```{r message=FALSE, warning=FALSE}
data(mtcars)
```
############ Definimos la función de comparación.
```{r message=FALSE, warning=FALSE}
Comp_reg <- function(x, y, Comparacion = c("lineal", "cuadratico")){
  Dtf <- data.frame(x = x, y = y)
  tb1 <- list()
  tb2 <- list()
  Grafico <- list()
  if ("lineal" %in% Comparacion){
      Reg <- lm(y ~ x, data = Dtf)
      tb1[["lineal"]] <- broom::glance(Reg) %>% mutate(modelo = "lineal")
      tb2[["lineal"]] <- broom::tidy(Reg) %>% mutate(modelo = "lineal")
      Grafico[["Lineal"]] <- ggplot(data= Dtf, aes(x = x, y = y)) + stat_smooth(method = "lm", formula =  y ~ x) + theme_bw()
  }
  if ("cuadratico" %in% Comparacion){
  Reg <- lm(y ~ x +I(x^2), data = Dtf)
  tb1[["cuadratico"]] <- broom::glance(Reg) %>% mutate(modelo = "cuadratico")
  tb2[["cuadratico"]] <- broom::tidy(Reg) %>% mutate(modelo = "cuadratico")
  Grafico[["cuadratico"]] <- ggplot(data= Dtf, aes(x = x, y = y)) + stat_smooth(method = "lm", formula =  y ~ x + I(x^2)) + theme_bw()
  }
  Tabla1 <- tb1 %>% reduce(bind_rows) %>% arrange(AIC)
  Tabla2 <- tb2[[Tabla1$modelo[[1]]]]
  Grafico <- Grafico[[Tabla1$modelo[[1]]]]
  print(Grafico)
  return(list(Tabla_Modelo = Tabla1, Tabla_Parametros = Tabla2, Grafico = Grafico))
  }
```
############ Ejemplo de uso de la función
```{r message=FALSE, warning=FALSE}
  Res <- Comp_reg(x = mtcars$hp, y = mtcars$mpg)
```



## Codigo de la 3era función 

############ Librerías usadas.
```{r message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(testthat)
```
############ Función que calcula la correlación y crea un ggplot
```{r message=FALSE, warning=FALSE}
my_corr_plot <- function(data, x_var, y_var) {
  
  # Verificar si los argumentos proporcionados son correctos
  if (!is.data.frame(data)) {
    stop("El argumento 'data' debe ser un dataframe.")
  }
  if (!(x_var %in% colnames(data))) {
    stop(paste0("La columna '", x_var, "' no existe en el dataframe."))
  }
  if (!(y_var %in% colnames(data))) {
    stop(paste0("La columna '", y_var, "' no existe en el dataframe."))
  }
  
  # Calcular la correlación
  corr <- cor(data[[x_var]], data[[y_var]])
  
  # Crear un ggplot
  my_plot <- ggplot(data, aes(x = !!sym(x_var), y = !!sym(y_var))) +
    geom_point() +
    labs(title = paste0("Correlacion: ", round(corr, 2)), encoding = "UTF-8")
  
  # Mostrar el ggplot
  print(my_plot)
  
  # Devolver la correlación
  return(corr)
}
```
############ Ejemplo de uso
```{r message=FALSE, warning=FALSE}
data(mtcars)
my_corr_plot(mtcars, "mpg", "wt")
```
############ expect_error() para verificar si se proporcionan argumentos incorrectos
```{r message=FALSE, warning=FALSE}
expect_error(my_corr_plot(iris, "foo", "bar"), "La columna 'foo' no existe en el dataframe.")
expect_error(my_corr_plot(iris, "Sepal.Length", "baz"), "La columna 'baz' no existe en el dataframe.")
expect_error(my_corr_plot(42, "mpg", "wt"), "El argumento 'data' debe ser un dataframe.")
```







